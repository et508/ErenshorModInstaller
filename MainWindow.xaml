<?xml version="1.0" encoding="utf-8"?>
<Window x:Class="ErenshorModInstaller.Wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Erenshor Mod Installer"
        Height="520" Width="700"
        WindowStartupLocation="CenterScreen"
        AllowDrop="True"
        Drop="Window_Drop"
        DragOver="Window_DragOver">
  <Grid Margin="14">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="8"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="8"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="8"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <StackPanel Grid.Row="2" Orientation="Horizontal" VerticalAlignment="Center">
      <TextBlock Text="Game Folder:" VerticalAlignment="Center"/>
      <TextBox x:Name="GamePathBox" Width="350" Margin="5,0,8,0"/>
      <Button Content="Browse…" Width="80" Margin="0,0,8,0" Click="Browse_Click"/>
      <Button Content="Open Plugins Folder" Width="120" Click="OpenPlugins_Click"/>
    </StackPanel>

    <Border Grid.Row="4" Padding="10" BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="6">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="8"/>
          <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel Orientation="Horizontal" Grid.Row="0" VerticalAlignment="Center">
          <TextBlock x:Name="StatusBlock" Margin="0,5,0,5" VerticalAlignment="Center" TextWrapping="Wrap"/>
        </StackPanel>

        <Grid Grid.Row="2">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="12"/>
            <ColumnDefinition Width="240"/>
          </Grid.ColumnDefinitions>

          <GroupBox Header="Installed Mods (BepInEx/plugins)" Grid.Column="0">
            <DockPanel LastChildFill="True">
              <ListBox x:Name="ModsList" Margin="6" HorizontalContentAlignment="Stretch"
                       ItemsSource="{Binding Mods}">
                <ListBox.ItemTemplate>
                  <DataTemplate>
                    <!-- Tooltip shows GUID -->
                    <StackPanel Orientation="Horizontal" ToolTip="{Binding Guid}">
                      <CheckBox Margin="0,0,8,0"
                                IsChecked="{Binding IsEnabled}"
                                Checked="ModToggle_Checked"
                                Unchecked="ModToggle_Unchecked"/>
                      <TextBlock Text="{Binding DisplayName}" VerticalAlignment="Center"/>

                      <!-- version: ' · vX.Y.Z' (hidden if empty) -->
                      <TextBlock Margin="4,0,0,0" Foreground="#999" VerticalAlignment="Center">
                        <TextBlock.Style>
                          <Style TargetType="TextBlock">
                            <Setter Property="Text" Value="{Binding Version, StringFormat= · v{0}}"/>
                            <Style.Triggers>
                              <DataTrigger Binding="{Binding Version}" Value="">
                                <Setter Property="Visibility" Value="Collapsed"/>
                              </DataTrigger>
                              <DataTrigger Binding="{Binding Version}" Value="{x:Null}">
                                <Setter Property="Visibility" Value="Collapsed"/>
                              </DataTrigger>
                            </Style.Triggers>
                          </Style>
                        </TextBlock.Style>
                      </TextBlock>

                      <!-- operational status (disabled/partial/no dll) -->
                      <TextBlock Margin="8,0,0,0" Foreground="#888" VerticalAlignment="Center"
                                 Text="{Binding StatusSuffix}"/>
                    </StackPanel>
                  </DataTemplate>
                </ListBox.ItemTemplate>
              </ListBox>
            </DockPanel>
          </GroupBox>

          <StackPanel Grid.Column="2">
            <TextBlock Text="Install a Mod" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,10"/>
            <TextBlock Text="Drop anywhere in this window, or click the button below."
                       TextWrapping="Wrap"/>
            <Button Content="Install Mod" Width="90" Margin="0,10,0,10" Click="InstallZip_Click"/>
            <Separator/>
            <TextBlock Text="Manage" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,10,0,10"/>
            <Button Content="Refresh List" Width="80" Margin="0,0,0,8" Click="RefreshMods_Click"/>
            <Button Content="Uninstall Selected" Width="120" Click="Uninstall_Click"/>
          </StackPanel>
        </Grid>
      </Grid>
    </Border>

    <StackPanel Grid.Row="6" Orientation="Horizontal" HorizontalAlignment="Left">
      <TextBlock Text="v1.0.1" Foreground="DarkGray" VerticalAlignment="Bottom" Margin="0,0,0,-10"/>
    </StackPanel>

    <StackPanel Grid.Row="6" Orientation="Horizontal" HorizontalAlignment="Right">
      <Button Content="Launch Erenshor" Height="30" Width="120" Margin="0,0,0,0" Click="LaunchErenshor_Click"/>
    </StackPanel>
  </Grid>
</Window>
